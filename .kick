lockfile_name = '.server_running_lockfile'

process do |files|

  files.delete_if do |file|
    file != 'app.rb'
  end

  unless files.empty?
    if File.exists?(lockfile_name)
      Process.kill('KILL', File.read(lockfile_name).to_i) rescue nil
      File.delete(lockfile_name)
    end
    pid = Process.spawn('bundle exec ruby ./app.rb webhook_notify_server')
    Process.detach(pid)
    File.open(lockfile_name, 'w') { |file| file << pid }
    files.delete('app.rb')
  end

end
